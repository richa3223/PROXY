# Redact EventBridge Events and Log to CloudWatch

Redacts the "sensitive" block from the standard event structure for any event that gets ingested into the reporting audit store.

## Configuration

The following settings are required for the lambda to run.

| Setting name | Purpose                    |
| ------------ | -------------------------- |
| log_group    | The log group to write to  |
| log_stream   | The log stream to write to |

## Parameters

The lambda requires inputs generated by AWS EventBridge, for an example see the local testing section.

## Outputs

| Output path | Data type | Purpose         |
| ----------- | --------- | --------------- |
| body        | json      | Success message |

NOTE: Redacted events are not returned to the caller instead are uploaded to specified CloudWatch log group.

## Local Testing

The following is a code sample of a python script that will allow the lambda to be run.

```python
from lambdas.redact_eventbridge_events_and_log_to_cloudwatch.main import lambda_handler

event = {
    "version": "0",
    "id": "edea8ba0-f469-acf9-3a99-7c95b07f0cc8",
    "detail-type": "Validation Successful",
    "source": "Validation Service",
    "account": "1236545",
    "time": "2024-06-07T07:48:57Z",
    "region": "eu-west-2",
    "resources": [],
    "detail": {
        "metadata": {
            "client-key": "739d1cb1-4eba-4201-934f-d354a39e973c",
            "correlation-id": "fee18326-88ec-42b1-8664-cfeb0ec63248",
            "created": "2024-06-06T11:41:52.931714",
            "request-id": "7e1a8ef9-d994-4f81-b21f-0ffe75876fa3",
        },
        "sensitive": {
            "patient-identifier": "9730675929",
            "proxy-identifier": "9730676399",
        },
        "standard": {
            "proxy-identifier-type": "NHS Number",
            "relationship-type": "",
            "validation-result-info": {
                "VALIDATED_RELATIONSHIP": "Validated Relationship"
            },
        },
    },
}

response = lambda_handler(event, None)

print(response)
```

## Deployment

This lambda function is deployed to AWS using Terraform CI / CD pipeline.
